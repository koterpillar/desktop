#!/bin/bash

set -e

DIR=$(readlink -f $(dirname $0))

# Packages
# TODO: obnam stack
sudo dnf copr enable -y pschyska/alacritty
sudo dnf copr enable -y mikelo2/keeweb
sudo dnf install -y \
  alacritty \
  curl \
  docker \
  ghc \
  git \
  git-lfs \
  hlint \
  htop \
  jq \
  lsof \
  KeeWeb \
  meld \
  moreutils \
  mosh \
  mozilla-fira-mono-fonts \
  nmap \
  nodejs \
  npm \
  pwgen \
  python \
  python3 \
  ripgrep \
  rlwrap \
  rsync \
  strace \
  tcpdump \
  tig \
  tmux \
  util-linux-user \
  vim \
  wget \
  youtube-dl \
  zsh \
  && true

# Shell
if [ $(getent passwd $USER | cut -d: -f7) != "/bin/zsh" ]
then
  chsh -s /bin/zsh
fi

$DIR/makelinks

# Systemd
sudo systemctl enable --no-reload \
  docker \
  sshd \
  && true
# Ignore reload errors if running in chroot
sudo systemctl daemon-reload || true
