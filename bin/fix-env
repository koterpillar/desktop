#!/bin/sh -e

setxkbmap -option altwin:swap_alt_win

has_connection () {
	nmcli --terse --fields name connection show --active | grep -v docker0 | grep -v "Wired Connection" | sha1sum | grep -q $1
}

case $(hostname) in
	taohua)
		SOUNDCARD=alsa_card.pci-0000_00_1f.3
		SOUND_OUTPUT=alsa_output.pci-0000_00_1f.3

		# Sometimes PulseAudio gets stuck on "null sink", changing the
		# output profile manually fixes it
		pactl set-card-profile $SOUNDCARD output:analog-stereo

		xrandr --auto
		if xrandr | grep -q "HDMI-1 connected"
		then
			xrandr --output HDMI-1 --primary --above eDP-1 --auto
			pactl set-card-profile $SOUNDCARD output:hdmi-stereo+input:analog-stereo
			pactl set-default-sink $SOUND_OUTPUT.hdmi-stereo
		else
			pactl set-card-profile $SOUNDCARD output:analog-stereo+input:analog-stereo
			pactl set-default-sink $SOUND_OUTPUT.analog-stereo
		fi
	;;
	yulan)
		xrandr --auto
		if xrandr | grep -q "DP-1 connected"
		then
			if has_connection 503314a033141b4654c78cca5d4bfe59fcbe6dc0 || \
				has_connection 6c3601e50a2c5d2bc0ae572fb4d5cc8431d7d9ec
			then
				xrandr --output DP-1 --primary --left-of eDP-1 --auto
				xrandr --output eDP-1 --pos 2560x600
			else
				xrandr --output DP-1 --primary --above eDP-1 --auto
			fi
		else
			:  # pass
		fi

		if has_connection 503314a033141b4654c78cca5d4bfe59fcbe6dc0 || \
			has_connection 6c3601e50a2c5d2bc0ae572fb4d5cc8431d7d9ec || \
			has_connection 81340f1c782c190b9c45e8967a63581f0451fb01
		then
			pactl set-sink-mute alsa_output.pci-0000_00_1f.3.analog-stereo 1
		fi
	;;
	shancha)
		xrandr --auto
		if xrandr | grep -q "HDMI1 connected"
		then
			xrandr --output HDMI1 --primary --above LVDS1 --auto
			pactl set-card-profile 0 output:hdmi-stereo+input:analog-stereo
		elif xrandr | grep -q "HDMI2 connected"
		then
			xrandr --output HDMI2 --primary --above LVDS1 --auto
			pactl set-card-profile 0 output:hdmi-stereo-extra1+input:analog-stereo
		elif xrandr | grep -q "DP1 connected"
		then
			if has_connection 503314a033141b4654c78cca5d4bfe59fcbe6dc0 || \
				has_connection 6c3601e50a2c5d2bc0ae572fb4d5cc8431d7d9ec
			then
				xrandr --output DP1 --primary --left-of LVDS1 --auto
				xrandr --output LVDS1 --pos 2560x700
				pactl set-card-profile 0 output:analog-stereo+input:analog-stereo
			else
				xrandr --output DP1 --primary --above LVDS1 --auto
				pactl set-card-profile 0 output:analog-stereo+input:analog-stereo
			fi
		elif xrandr | grep -q "VGA1 connected"
		then
			xrandr --output VGA1 --primary --above LVDS1 --auto
			pactl set-card-profile 0 output:analog-stereo+input:analog-stereo
		else
			pactl set-card-profile 0 output:analog-stereo+input:analog-stereo
		fi
		if has_connection 503314a033141b4654c78cca5d4bfe59fcbe6dc0 || \
			has_connection 6c3601e50a2c5d2bc0ae572fb4d5cc8431d7d9ec || \
			has_connection 81340f1c782c190b9c45e8967a63581f0451fb01
		then
			pactl set-sink-mute alsa_output.pci-0000_00_1b.0.analog-stereo 1
		fi
	;;
esac

if [ -f ~/.fehbg ]
then
	. ~/.fehbg
fi
