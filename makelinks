#!/bin/bash -e

DIR=$(readlink -f $(dirname $0))

# Config and dotfiles
mkdir -p $HOME/.config
ls $DIR/config | xargs -I FILE ln -sfnT $DIR/config/FILE $HOME/.config/FILE
ls $DIR/dotfiles | xargs -I FILE ln -sfnT $DIR/dotfiles/FILE $HOME/.FILE
ln -sfnT $DIR/bin $HOME/bin

# Git repositories
submodule () {
    if [ ! -d "$1"/.git ]
    then
        # Ignore the config file as the SSH keys might not yet be there
        HOME=/dev/null XDG_CONFIG_HOME=/dev/null git clone "$2" "$1"
    fi
}

submodule $HOME/.emacs.d https://github.com/syl20bnr/spacemacs
submodule $HOME/.vim https://github.com/koterpillar/vim.git
submodule $HOME/.zgen https://github.com/tarjoilija/zgen.git

# xdg-mime ignores $XDG_CONFIG_HOME/mimeapps.list
mkdir -p $HOME/.local/share/applications
ln -sf $HOME/.config/mimeapps.list $HOME/.local/share/applications/mimeapps.list
